<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>GreenRide</title>
    <link rel="stylesheet" th:href="@{/css/greenride.css}">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
</head>
<body>

<header class="topbar">
    <a class="brand" th:href="@{/}">
        <iconify-icon icon="mdi:leaf" width="24" height="24" style="color: #fff"></iconify-icon>
        <span class="name">GreenRide</span>
    </a>

    <div class="top-actions">
        <a class="pill-btn" th:if="${loggedIn != true}" th:href="@{/login}">Login</a>

        <div class="user-info" th:if="${loggedIn == true}">
            <span class="username" th:text="${displayName}">username</span>

            <a class="top-icon" th:href="@{/profile}">
                <iconify-icon icon="iconamoon:profile-circle-fill"
                              width="34"
                              height="34"></iconify-icon>
            </a>
        </div>

        <a class="pill-btn admin-btn" th:if="${isAdmin == true}" th:href="@{/admin/reviews}">
            Admin Reviews
        </a>

        <form th:if="${loggedIn == true}" th:action="@{/logout}" method="post" class="logout-form">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="pill-btn logout-btn">Logout</button>
        </form>
    </div>
</header>

<main class="page">

    <div class="columns">

        <section class="col">
            <h1 class="section-title">Available Trips</h1>

            <div class="trip-list">
                <div class="trip-card"
                     th:if="${availableTrips != null and !#lists.isEmpty(availableTrips)}"
                     th:each="t : ${availableTrips}">

                    <div class="trip-info">
                        <div class="trip-line strong"
                             th:text="${t.startingPoint() + ' - ' + t.destination()}">
                            Starting Point - Destination
                        </div>

                        <div class="trip-line"
                             th:text="${#temporals.format(t.departureTime(), 'dd/MM/yyyy HH:mm')}">
                            Departure Time
                        </div>

                        <div class="trip-line"
                             th:text="${'Available Seats: ' + t.availableSeats()}">
                            Available Seats: 0
                        </div>
                    </div>

                    <div class="trip-actions">
                        <form th:if="${loggedIn == true and isAdmin != true}"
                              th:action="@{/trips/{id}/book(id=${t.id()})}"
                              method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button class="btn btn-success" type="submit"
                                    th:disabled="${t.availableSeats() <= 0}">
                                Book Seat
                            </button>
                        </form>
                    </div>

                </div>

                <div class="trip-card" th:if="${availableTrips == null or #lists.isEmpty(availableTrips)}">
                    <div class="trip-info">
                        <div class="trip-line strong">No available trips</div>
                        <div class="trip-line">Please check again later.</div>
                    </div>
                </div>
            </div>
        </section>

        <div class="divider"></div>

        <section class="col">
            <h1 class="section-title">Upcoming Trips</h1>

            <div class="trip-list">
                <div class="trip-card"
                     th:if="${upcomingTrips != null and !#lists.isEmpty(upcomingTrips)}"
                     th:each="t : ${upcomingTrips}">

                    <div class="trip-info">
                        <div class="trip-line strong"
                             th:text="${t.startingPoint() + ' - ' + t.destination()}">
                            Starting Point - Destination
                        </div>

                        <div class="trip-line"
                             th:text="${#temporals.format(t.departureTime(), 'dd/MM/yyyy HH:mm')}">
                            Departure Time
                        </div>

                        <div class="trip-line"
                             th:text="${'Available Seats: ' + t.availableSeats()}">
                            Available Seats: 0
                        </div>
                    </div>

                    <div class="trip-actions">
                        <a class="btn btn-details"
                           th:href="@{/trips/{id}(id=${t.id()})}">
                            Trip Details
                        </a>

                        <div class="cancel-wrapper"
                             th:classappend="${t.departureTime() != null and !t.departureTime().isAfter(nowPlus10)} ? ' disabled' : ''">

                            <form th:action="@{/trips/{id}/cancel(id=${t.id()})}"
                                  method="post">
                                <input type="hidden"
                                       th:name="${_csrf.parameterName}"
                                       th:value="${_csrf.token}"/>

                                <button class="btn btn-danger"
                                        type="submit"
                                        th:disabled="${t.departureTime() != null and !t.departureTime().isAfter(nowPlus10)}">
                                    Cancel Trip
                                </button>
                            </form>

                            <span class="cancel-hint"> Too late to cancel </span>
                        </div>
                    </div>

                </div>

                <div class="trip-card" th:if="${upcomingTrips == null or #lists.isEmpty(upcomingTrips)}">
                    <div class="trip-info">
                        <div class="trip-line strong">No upcoming trips</div>
                        <div class="trip-line"
                             th:text="${loggedIn == true ? 'Create or book a trip.' : 'Login to see your trips.'}">
                            Login to see your trips.
                        </div>
                    </div>
                </div>
            </div>

            <div class="new-trip" th:if="${loggedIn == true and isAdmin != true}">
                <a class="new-trip-btn" th:href="@{/trips/new}">
                    + New Trip
                </a>
            </div>

        </section>
    </div>

</main>

</body>
</html>
