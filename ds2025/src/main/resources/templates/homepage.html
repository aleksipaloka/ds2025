<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>GreenRide</title>
    <link rel="stylesheet" th:href="@{/css/greenride.css}">
</head>
<body>

<header class="topbar">
    <div class="brand">
        <span class="leaf">üçÉ</span>
        <span class="name">GreenRide</span>
    </div>

    <div class="top-actions">
        <!-- Guest -->
        <a class="pill-btn" th:if="${loggedIn != true}" th:href="@{/login}">Login</a>

        <!-- Logged in -->
        <a class="pill-btn" th:if="${loggedIn == true}" th:href="@{/profile}">Profile</a>

        <!-- Logout MUST be POST for Spring Security -->
        <form th:if="${loggedIn == true}" th:action="@{/logout}" method="post" class="logout-form">
            <button type="submit" class="pill-btn">Logout</button>
        </form>
    </div>
</header>


<main class="home">

    <div class="columns">
        <!-- LEFT -->
        <section class="col">
            <h1>Available Trips</h1>

            <div class="trip-list">
                <div class="trip-card" th:each="t : ${availableTrips}">
                    <div class="trip-info">
                        <div class="trip-line strong"
                             th:text="${t.startingPoint() + ' - ' + t.destination()}">
                            Starting Point - Destination
                        </div>

                        <div class="trip-line"
                             th:text="${#temporals.format(t.departureTime(), 'dd/MM/yyyy HH:mm')}">
                            Departure Time
                        </div>

                        <div class="trip-line"
                             th:text="${'Available Seats: ' + t.availableSeats()}">
                            Available Seats: 0
                        </div>
                    </div>

                    <div class="trip-actions">
                        <!-- Book (only logged in) -->
                        <form th:if="${loggedIn == true}"
                              th:action="@{/trips/{id}/book(id=${t.id()})}"
                              method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button class="btn book" type="submit"
                                    th:disabled="${t.availableSeats() <= 0}">
                                Book Seat
                            </button>
                        </form>

                        <!-- Guest sees disabled button -->
                        <button th:if="${loggedIn != true}" class="btn book" type="button" disabled>
                            Book Seat
                        </button>
                    </div>
                </div>

                <div class="trip-card" th:if="${availableTrips == null || #lists.isEmpty(availableTrips)}">
                    <div class="trip-info">
                        <div class="trip-line strong">No trips yet</div>
                        <div class="trip-line">Please check again later.</div>
                        <div class="trip-line">Available Seats: -</div>
                    </div>
                    <div class="trip-actions">
                        <button class="btn book" type="button" disabled>Book Seat</button>
                    </div>
                </div>
            </div>
        </section>

        <div class="divider"></div>

        <!-- RIGHT -->
        <section class="col">
            <h1>Upcoming Trips</h1>

            <div class="trip-list">
                <div class="trip-card" th:each="t : ${upcomingTrips}">
                    <div class="trip-info">
                        <div class="trip-line strong"
                             th:text="${t.startingPoint() + ' - ' + t.destination()}">
                            Starting Point - Destination
                        </div>

                        <div class="trip-line"
                             th:text="${#temporals.format(t.departureTime(), 'dd/MM/yyyy HH:mm')}">
                            Departure Time
                        </div>

                        <div class="trip-line"
                             th:text="${'Available Seats: ' + t.availableSeats()}">
                            Available Seats: 0
                        </div>
                    </div>

                    <div class="trip-actions">
                        <!-- Cancel (driver deletes, passenger unbooks) -->
                        <form th:action="@{/trips/{id}/cancel(id=${t.id()})}"
                              method="post">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button class="btn cancel" type="submit">Cancel Trip</button>
                        </form>
                    </div>
                </div>

                <div class="trip-card" th:if="${upcomingTrips == null || #lists.isEmpty(upcomingTrips)}">
                    <div class="trip-info">
                        <div class="trip-line strong">No upcoming trips</div>
                        <div class="trip-line" th:text="${loggedIn == true ? 'Create or book one.' : 'Login to see yours.'}">
                            Login to see yours.
                        </div>
                        <div class="trip-line">Available Seats: -</div>
                    </div>
                    <div class="trip-actions">
                        <button class="btn cancel" type="button" disabled>Cancel Trip</button>
                    </div>
                </div>
            </div>

            <a class="new-trip-btn" th:if="${loggedIn == true}" th:href="@{/trips/new}">+ New Trip</a>
        </section>
    </div>

</main>

</body>
</html>
